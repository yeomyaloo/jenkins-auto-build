# ğŸ˜ jenkins auto build
- ì  í‚¨ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë¹Œë“œ ì‘ì—…ì„ ìë™í™” í•˜ê¸°


# ğŸ”¨ Architecture
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/b1dca453-1c6e-437f-8c1e-7e491cfcbfdf)



# âœ Process
## 1. EC2 ìƒì„±
- ë³¸ì¸ AWS ê³„ì •ìœ¼ë¡œ EC2ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”

## 2. puttyë‚˜ mobaxtermì„ ì´ìš©í•œ EC2 í™˜ê²½ ì—°ê²°í•˜ê¸°
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/ebfe4c22-2bf8-4a6a-82c1-0b7e7dc0fa3c)

## 3. EC2 ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì—ì„œ ë„ì»¤ë¥¼ ì´ìš©í•œ ì  í‚¨ìŠ¤ ì‹¤í–‰ ë° ì„¤ì¹˜
#### 3-1. ì  í‚¨ìŠ¤ ì„¤ì¹˜ ì „ì— apt ì—…ë°ì´íŠ¸ ì—…ê·¸ë ˆì´ë“œ ê·¸ë¦¬ê³  ë„ì»¤ ì„¤ì¹˜
- `sudo apt update`
- `sudo apt upgrad`
- `sudo ducker install docker.io`
#### 3-2. ë„ì»¤ì•ˆì— ì  í‚¨ìŠ¤ ì‹¤í–‰ ë° ì„¤ì¹˜ ëª…ë ¹ì–´
- `docker run --name myjenkins --privileged -p 8080:8080 jenkins/jenkins:lts-jdk17tomca`
  - ì  í‚¨ìŠ¤ ë„ì»¤ ì´ë¦„ì„ myjenkinsë¡œ ì§€ì •
  - ê¶Œí•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ privileged ì˜µì…˜ ì‚¬ìš©
  - í¬íŠ¸ ë²ˆí˜¸ë¥¼ 8080ìœ¼ë¡œ ê°€ì§„ ì  í‚¨ìŠ¤ì™€ ë„ì»¤ì—ì„œ ì‚¬ìš©í•  í¬íŠ¸ë²ˆí˜¸ë¥¼ 8080ìœ¼ë¡œ ë™ì¼í•˜ê²Œ ë§¤í•‘
  - ë‹¤ìš´ ë°›ì„ ì  í‚¨ìŠ¤ ì´ë¯¸ì§€ ë²„ì „ ëª…ì‹œ

#### 3-3. ëª…ë ¹ì–´ ì…ë ¥ í›„ì—
- ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ ë°›ì€ ë’¤ë¼ë©´ ì  í‚¨ìŠ¤ê°€ ì‹¤í–‰ë  ê²ƒì´ì—ìš”.
- ë˜í•œ ì½˜ì†”ì— í•´ë‹¹ ì  í‚¨ìŠ¤ ì–´ë“œë¯¼ ê³„ì •ì— ì ‘ê·¼ ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤.
- ì´ë¥¼ ì´ìš©í•´ì„œ ì  í‚¨ìŠ¤ ì›¹ í˜ì´ì§€ì— ì ‘ê·¼í•´ì„œ ì ‘ì†í•´ë´…ì‹œë‹¤.

> ì´ë¯¸ ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆê°€ ê¹”ë ¤ ìˆë‹¤ë©´?<br>
> `docker start <ì»¨í…Œì´ë„ˆ_ëª… í˜¹ì€ ì»¨í…Œì´ë„ˆ_ì•„ì´ë””>`: ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ ì‹œì¼œì¤ë‹ˆë‹¤.<br>
> `docker logs -f <ì»¨í…Œì´ë„ˆ_ëª… í˜¹ì€ ì»¨í…Œì´ë„ˆ_ì•„ì´ë””>`: ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ”ë° ì´ë•Œ ì  í‚¨ìŠ¤ ì–´ë“œë¯¼ ê³„ì •ì— ì ‘ê·¼ ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ë„ ì½˜ì†”ì— í•¨ê»˜ ì¶œë ¥ ë©ë‹ˆë‹¤.

## 4. ì  í‚¨ìŠ¤ ì›¹ ì ‘ì†
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/62d78513-86d7-484f-a6da-5f11facd583d)
- EC2 í¼ë¸”ë¦­ ì•„ì´í”¼ë¥¼ ì´ìš©í•´ì„œ ë„ì»¤ì—ì„œ ì  í‚¨ìŠ¤ë¥¼ ë‹¤ìš´ ë°›ì„ ë•Œ ë§¤í•‘í•œ í¬íŠ¸ë¥¼ ì¡°í•©í•´ URLì„ ì…ë ¥í•˜ë©´ ìœ„ì™€ ê°™ì´ ì  í‚¨ìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•œ ì›¹í˜ì´ì§€ê°€ ëœ¹ë‹ˆë‹¤.
  - ex) http://EC2_public_ip:8080/

#### 4-1. íŒŒì´í”„ë¼ì¸ ìƒì„±
- [í•´ë‹¹ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„ ì´ìš©í•´ì„œ íŒŒì´í”„ ë¼ì¸ ìƒì„± ë“±ì„ ì§ì ‘ í•´ì£¼ì„¸ìš”](https://narup.tistory.com/224)

#### 4-2. ì  í‚¨ìŠ¤ë¥¼ ì´ìš©í•œ ìë™ ë¹Œë“œì— ì‚¬ìš©í•œ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸
```
pipeline {
    agent any

    stages {
        stage('git') {
            steps {
                git branch: 'main', 
                credentialsId: 'ë°œê¸‰ë°›ì€credentialsId',
                url: 'ë³¸ì¸ê¹ƒí—ˆë¸Œì£¼ì†Œ'
            }
        }
        stage('Build'){
            steps{
                
                sh '''./gradlew clean build '''
                
            }
            
        }
    }
}
```
- `sh ''' '''`ë¥¼ ì‚¬ìš©í•˜ë©´ ì‰˜ìŠ¤í¬ë¦½íŠ¸ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
  - ì  í‚¨ìŠ¤ ë‚´ì—ì„œ í•´ë‹¹ íŒŒì´í”„ë¼ì¸ì„ ì§€ê¸ˆ ë¹Œë“œë¥¼ ëˆ„ë¥´ê²Œ ë ë•Œë§ˆë‹¤ ìœ„ì˜ clean í›„ build ì‘ì—…ì´ ì§„í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.

## ê¹ƒí—ˆë¸Œ ì›¹í›…
- [í•´ë‹¹ í¬ìŠ¤íŒ…ì„ ì´ìš©í•´ì„œ ê¹ƒí—ˆë¸Œ ì›¹í›…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”](https://hororolol.tistory.com/528) 
- ë¡œì»¬ í™˜ê²½ì—ì„œ ì‘ì—…ì„ ì§„í–‰í•œë‹¤ë©´ ngrokì„ ì´ìš©í•´ì„œ ì™¸ë¶€ í™˜ê²½ì—ì„œ ë¡œì»¬ ì•„ì´í”¼ë¥¼ ì ‘ì† ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ì…”ì„œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤. 
## EC2 í”„ë¦¬í‹°ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì  í‚¨ìŠ¤ë¥¼ ì´ìš©í•œ ë¹Œë“œ ì‘ì—…ì´ ë¨¹í†µì¼ ë•?
#### 1. ì£¼ì˜

ì‚¬ìš© ì¤‘ì¸ EC2 ì¢…ë¥˜ì— ë”°ë¼ì„œ ìŠ¤ì™‘ ê³µê°„ë„ ë‹¤ë¥´ê²Œ ë¶€ì—¬í•´ì¤€ë‹¤. ì´ë¥¼ ì‚´í´ë³´ê³  ì§„í–‰í•˜ì!

#### 2. ìŠ¤ì™‘ ê³µê°„ ìƒì„± ì „ ìƒíƒœ í™•ì¸
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/12f58071-cb71-46c2-ada8-70410138f44c)
- `free -h`

#### 3. dd ëª…ë ¹ì–´ë¡œ ë£¨íŠ¸ ê²½ë¡œì— ìŠ¤ì™‘ íŒŒì¼ ìƒì„±

`sudo dd if=/dev/zero of=/swapfile bs=128M count=16` 

> - bs : ë¸”ë¡ì˜ í¬ê¸°
> - count : ë¸”ë¡ ìˆ˜
> - ìŠ¤ì™‘ íŒŒì¼ì˜ í¬ê¸° = ë¸”ë¡ì˜ í¬ê¸° * ë¸”ë¡ì˜ ìˆ˜
> - ì¦‰, 128M * 16 = 2GBì´ë¼ì„œ ìœ„ì™€ ê°™ì´ ì…ë ¥í•œë‹¤. ìŠ¤ì™‘ íŒŒì¼ì˜ í¬ê¸°ê°€ 2GBê°€ ë˜ëŠ” ê²ƒì´ë‹¤.


#### 4. ìŠ¤ì™‘ íŒŒì¼ ì½ê¸° ë° ì“°ê¸° ê¶Œí•œ ì—…ë°ì´íŠ¸ ì‘ì—…
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/eca1470c-3216-483b-8ad6-9e3d634fafe1)
- í•´ë‹¹ ìŠ¤ì™‘ íŒŒì¼ì€ ìµœìƒë‹¨ ê²½ë¡œì— ìƒì„± ëœë‹¤.
- í•´ë‹¹ ìµœìƒë‹¨ ê²½ë¡œë¡œ ê°€ì„œ ë””ë ‰í† ë¦¬ í™•ì¸ì„ í•˜ë©´ swapfileì´ ìƒê¸°ëŠ” ê²ƒì„ í™•ì¸ í• ìˆ˜ ìˆë‹¤.
    - `cd /`
    - `ls`
- `sudo chmod 600 /swapfile` ìŠ¤ì™‘ íŒŒì¼ì˜ ì½ê¸° ë° ì“°ê¸° ê¶Œí•œ ì—…ë°ì´íŠ¸
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/01288b08-08f9-4a2e-aaf5-e08835aeeb5d)

#### 5. ìŠ¤ì™‘ ì˜ì—­ì„ ìœ„í•´ ë§Œë“  íŒŒì¼ë¡œ ì„¤ì •
- `sudo mkswap /swapfile`

#### 6. í”„ë¡œì‹œì €ê°€ ì„±ê³µì ì¸ì§€ í™•ì¸
- `sudo swapon -s`
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/5f483045-dd0f-42c2-bbda-cee26f2e24ca)

### 7. /etc/fstab íŒŒì¼ì„ í¸ì§‘ í›„ ë¶€íŒ… ì‹œ ìŠ¤ì™‘ íŒŒì¼ì´ ì‹œì‘ë˜ê²Œ ì„¤ì •
- `sudo vi /etc/fstab`
    - `/swapfile swap swap defaults 0 0` : í…ìŠ¤íŠ¸ í¸ì§‘ ì‹œ `i` í˜¹ì€ `insert` í‚¤ë¥¼ ëˆ„ë¥¸ ë’¤ ë¬¸êµ¬ë¥¼ ë„£ì„ ìˆ˜ ìˆê²Œ í•˜ê³  í•´ë‹¹ ë¬¸êµ¬ ë„£ê³  ì €ì¥!
    - Esc â†’ :wq! â†’ Enter
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/988b5b4d-efc7-4258-997c-692ec74007fa)

#### 8. ìŠ¤ì™‘ê³µê°„ì´ í• ë‹¹ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸°
![image](https://github.com/yeomyaloo/jenkins-auto-build/assets/81970382/8270733b-6966-457d-9a06-579fc5943719)

- `free -h`
- 2Gë¡œ í• ë‹¹ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  
